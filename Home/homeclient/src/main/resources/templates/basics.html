<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" lang="de">

<head th:fragment="head (name)">
	<title th:text="${name}">Titel</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width = device-width, height = device-height, initial-scale=1, minimum-scale = 1.0, maximum-scale = 1.0, viewport-fit=cover"></meta>
	<meta http-equiv="expires" content="0"></meta>
	<meta name="mobile-web-app-capable" content="yes"></meta>
	<meta name="apple-mobile-web-app-capable" content="yes"></meta>
	<meta name="apple-mobile-web-app-status-bar-style" content="black"></meta>
	
	<link rel="apple-touch-icon" sizes="72x72" href="apple-touch-icon-72x72.png"></link>
	<link rel="apple-touch-icon" sizes="76x76" href="apple-touch-icon-76x76.png"></link>
	<link rel="apple-touch-icon" sizes="114x114" href="apple-touch-icon-114x114.png" ></link>
	<link rel="apple-touch-icon" sizes="120x120" href="apple-touch-icon-120x120.png"></link>
	<link rel="apple-touch-icon" sizes="144x144" href="apple-touch-icon-144x144.png"></link>
	<link rel="apple-touch-icon" sizes="152x152" href="apple-touch-icon-152x152.png"></link>
	<link rel="apple-touch-icon" sizes="167x167" href="apple-touch-icon-167x167.png"></link>
	<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon-180x180.png"></link>
	<link rel="icon" href="favicon.ico" type="image/x-icon"></link>
	<link rel="icon" sizes="152x152" href="apple-touch-icon-152x152.png">
	<link rel="icon" sizes="180x180" href="apple-touch-icon-180x180.png">
	<link rel="shortcut icon" href="favicon.ico"></link>
	
	<link rel='stylesheet' href='style.v3_1_4.css'/>
	
	<link rel='stylesheet' href='/webjars/bootstrap/css/bootstrap.min.css'/>
	
	<link rel="stylesheet" href="/webjars/font-awesome/css/all.min.css" crossorigin="anonymous"/>
	<script type="text/javascript" src="/webjars/jquery/jquery.min.js"></script>
</head>

<th:block th:fragment="scriptresources">

	<script type="text/javascript" src="/webjars/bootstrap/js/bootstrap.min.js"></script>

	<script>
	
		function showUserErrorMessage(){
			if(document.getElementById('idUserErrorMessage')){
				$('#idUserErrorMessage').modal('show');
			}
		}	
	
		function submitContent(target){
			if(navigator.onLine){
				var httpRequest = new XMLHttpRequest();
				httpRequest.open('GET', target);
				httpRequest.setRequestHeader('ETag', document.getElementById('modelTimestamp').value);
				httpRequest.send();
				httpRequest.onreadystatechange=(e)=>{
					if (httpRequest.readyState == 4) {
						if(httpRequest.status == 200){
							var doc = new DOMParser().parseFromString(httpRequest.responseText, "text/html");
							document.getElementById('idbody').innerHTML = doc.getElementById('idbody').innerHTML;
							lastRefresh = (new Date).getTime();
							showCheck();
							showUserErrorMessage();
						} else if(httpRequest.status == 304){	
							lastRefresh = (new Date).getTime();
							showCheck();
						}else{
							showOffline();
						}
					}
				}	
			}else{
				showOffline();
			}
		}
		
		
		function submitSetting(target){
			var httpRequest = new XMLHttpRequest();
			httpRequest.open('GET', target);
			httpRequest.send();
			httpRequest.onreadystatechange=(e)=>{
				if (httpRequest.readyState == 4) {
					if(httpRequest.status == 200){
						var doc = new DOMParser().parseFromString(httpRequest.responseText, "text/html");
						document.getElementById('idbody').innerHTML = doc.getElementById('idbody').innerHTML;
					}
				}
			}	
		}		
	
		function refreshContent(){
			submitContent(window.location.href);
		}
		
		function showCheck(){
			if (document.getElementById('statusline') !== null ) {
				document.getElementById('navbarcheck').style.display = 'inline';
				document.getElementById('navbaroffline').style.display = 'none';
			}
		}	
		function showOffline(){
			if (document.getElementById('statusline') !== null ) {
				document.getElementById('navbarcheck').style.display = 'none';
				document.getElementById('navbaroffline').style.display = 'inline';
			}			
		}	
		
		showUserErrorMessage();
		
	</script>

</th:block>

<th:block th:fragment="autorefresh">
	
	<script>
		function setAutoRefresh(){
			unsetAutoRefresh();
			autoRefresh = setTimeout(doAutoRefresh, 1000 * 2);
		}
		function unsetAutoRefresh(){
			if(autoRefresh !== null){
				clearTimeout(autoRefresh);
				autoRefresh = null;
			}
		}	
		function doAutoRefresh(){
			
			if(document.hasFocus() && $('.modal.fade.show').length === 0 && ((new Date).getTime() - lastRefresh > (1000))){
				refreshContent();
			}
			if(document.hasFocus()){
				setAutoRefresh();
			}
		}
	</script>	
	
	<script>
		var element = document.getElementById('idbody');
		
		var autoRefresh = null;
		var lastRefresh = (new Date).getTime();
		setAutoRefresh();
		
		if (element !== null && element.value !== '') {
			// onfocus
			document.getElementById('idbody').onfocus = function(){
				doAutoRefresh(); 
				setAutoRefresh();			
			};
			// onblur
			document.getElementById('idbody').onblur = function(){
				unsetAutoRefresh();			
			};			
		}
	</script>
	
</th:block>

<th:block th:fragment="symbol (name)"><i th:class="${name}"></i></th:block> <!-- //NOSONAR -->
<th:block th:fragment="symbolWithStyle (name, style)"><i th:style="${style}" th:class="${name}"></i></th:block> <!-- //NOSONAR -->

<!-- Modal User-ErrorMessage-->
<th:block th:fragment="userErrorMessage (text)">

	<div class="modal fade" id="idUserErrorMessage" tabindex="-1" role="dialog">
	  <div class="modal-dialog modal-dialog-centered" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" th:text="'Fehler:'"></h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body"><a th:utext="${text}"></a></div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-dismiss="modal">OK</button>
	      </div>	      
	    </div>
	  </div>
	</div>
	
</th:block>

<body>

	<!-- Navigation -->
	<div th:fragment="navigation (selected, selectable, status)">
		<nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-light py-1" style="border-bottom: 4px solid #C0C0C0;">
			
			<a class="navbar-brand" href="#">
				<span><th:block th:replace="basics :: symbol (name=${selected.icon})"/></span>
				<span th:text="${selected.name}"></span>
			</a>
			<a id="statusline" class="text-muted font-weight-light ml-auto" style="font-size: 85%; margin-right:15px">
				<span th:text="${status}"></span>
				<span style="display:inline;" id="navbarcheck"><th:block th:replace="basics :: symbol (name='far fa-check-circle')"/></span>
				<span style="display:none;" id="navbaroffline"><th:block th:replace="basics :: symbol (name='fas fa-exclamation-triangle text-danger')"/></span>
			</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse"
				data-target="#navbarSupportedContent"
				aria-controls="navbarSupportedContent" aria-expanded="false"
				aria-label="Toggle navigation">
				<span id="navbartoggle" class="navbar-toggler-icon-"><th:block th:replace="basics :: symbol (name='fas fa-bars')"/></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav ml-auto">
					<th:block th:each="entry : ${selectable}">
						<li class="nav-item" style="cursor:pointer"><a class="nav-link" th:onclick="@{'menu_' + ${entry.name} + '()'}"
							th:text="${entry.name}">name</a></li>
					</th:block>
				</ul>
			</div>
			<th:block th:each="entry : ${selectable}">
				<script type="text/javascript">
					function menu_[[${entry.name}]](){
						window.location.href = "[[${entry.path}]]";
					}		
				</script>		
			</th:block>
		</nav>
		<div style="height: 50px;"></div>
	</div>
	
</body>
</html>